- name: Powercalc Current Power
  unique_id: powercalc_current_power
  unit_of_measurement: W
  device_class: power
  state_class: measurement
  state: >
    {% set ns = namespace(states=[]) %}
    {% for s in states.sensor %}
      {% if s.object_id.endswith('_device_power') %}
        {% set ns.states = ns.states + [ s.state | float ] %}
      {% endif %}
    {% endfor %}
    {{ ns.states | sum | round(2) }}


- name: Powercalc Total Energy
  unique_id: powercalc_total_energy
  unit_of_measurement: kWh
  device_class: power
  state_class: measurement
  state: >
    {% set ns = namespace(states=[]) %}
    {% for s in states.sensor %}
      {% if s.object_id.endswith('_device_energy') %}
        {% set ns.states = ns.states + [ s.state | float ] %}
      {% endif %}
    {% endfor %}
    {{ (ns.states | sum) | round(2) }}
